<ion-content class="bg-gray-50/30">
    <div class="max-w-4xl mx-auto px-6 py-16">

        <!-- Results Header -->
        <div
            class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6 opacity-0 animate-slide-up animate-delay-1 transition-all">
            <div>
                <div class="flex items-center gap-2 mb-1">
                    <h1 class="text-2xl font-bold text-gray-900 tracking-tight">Live Results</h1>
                    <div class="flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-green-50 border border-green-100">
                        <div class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></div>
                        <span class="text-[9px] font-bold text-green-600 uppercase tracking-wider">Live</span>
                    </div>
                </div>
                <p class="text-xs text-gray-400 font-semibold tracking-wide uppercase">University Voting System</p>
            </div>

            <div class="flex items-center gap-2">
                <button (click)="refreshResults()"
                    class="flex items-center gap-2 px-3 py-1.5 bg-white border border-gray-100 rounded-xl text-gray-600 font-bold text-xs shadow-sm hover:bg-gray-50 transition-all">
                    <ion-icon name="refresh-outline" class="text-base"></ion-icon>
                    Refresh
                </button>
                <button
                    class="flex items-center gap-2 px-3 py-1.5 bg-white border border-gray-100 rounded-xl text-gray-600 font-bold text-xs shadow-sm hover:bg-gray-50 transition-all">
                    <ion-icon name="share-social-outline" class="text-base"></ion-icon>
                    Share
                </button>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="opacity-0 animate-slide-up animate-delay-2">
                <app-stat-card label="Total Votes" [value]="stats().totalVotes | number" icon="checkbox-outline"
                    colorClass="text-blue-600 bg-blue-50" dotColor="bg-blue-500" [isLive]="true"></app-stat-card>
            </div>
            <div class="opacity-0 animate-slide-up animate-delay-3">
                <app-stat-card label="Voter Turnout" [value]="stats().voterTurnout + '%'" icon="people-outline"
                    colorClass="text-emerald-600 bg-emerald-50"></app-stat-card>
            </div>
            <div class="opacity-0 animate-slide-up animate-delay-4">
                <app-stat-card label="Eligible Voters" [value]="stats().eligibleVoters | number"
                    icon="trending-up-outline" colorClass="text-orange-600 bg-orange-50"></app-stat-card>
            </div>
            <div class="opacity-0 animate-slide-up animate-delay-5">
                <app-stat-card label="Time Remaining" [value]="stats().timeRemaining" icon="time-outline"
                    colorClass="text-rose-600 bg-rose-50"></app-stat-card>
            </div>
        </div>

        <!-- Detailed Results Section -->
        <div
            class="bg-white border border-gray-100 rounded-3xl p-6 shadow-sm opacity-0 animate-slide-up animate-delay-6 transition-all">

            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                <div class="relative w-full md:w-72">
                    <label
                        class="text-[10px] text-gray-400 font-bold uppercase tracking-widest block mb-1.5 ml-1">Select
                        Election</label>
                    <div class="relative">
                        <select (change)="onElectionChange($event)"
                            class="block w-full pl-4 pr-10 py-2.5 text-sm font-bold text-gray-900 bg-gray-50 border-none rounded-xl appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer transition-all">
                            @for (election of allElectionResults(); track election.electionId) {
                            <option [value]="election.electionId"
                                [selected]="selectedElectionId() === election.electionId">
                                {{ election.electionName }}
                            </option>
                            }
                        </select>
                        <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none">
                            <ion-icon name="chevron-down-outline" class="text-gray-400"></ion-icon>
                        </div>
                    </div>
                </div>
                <div class="flex flex-col items-end">
                    <span class="text-[10px] text-gray-400 uppercase tracking-widest font-bold">Updated Recently</span>
                    <span class="text-xs font-bold text-gray-900">{{ stats().lastUpdated }}</span>
                </div>
            </div>

            <div class="space-y-12">
                @if (resultsByPosition().length > 0) {
                @for (position of resultsByPosition(); track position.name) {
                <div class="space-y-5 animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div class="flex items-center justify-between border-b border-gray-100 pb-3">
                        <div class="flex items-center gap-2">
                            <div class="w-1 h-6 bg-blue-600 rounded-full"></div>
                            <h2 class="text-lg font-extrabold text-gray-900 tracking-tight">
                                {{ position.name }}
                            </h2>
                        </div>
                        <ion-badge color="light" class="font-bold text-[10px] uppercase tracking-wider px-2.5 py-1">
                            {{ position.totalVotes | number }} Total Votes
                        </ion-badge>
                    </div>

                    <div class="grid gap-4">
                        @for (candidate of position.candidates; track candidate.id; let i = $index) {
                        <div class="opacity-0 animate-slide-up" [style.animation-delay]="(i * 100) + 'ms'"
                            style="animation-fill-mode: forwards;">
                            <app-result-card [candidate]="candidate" [totalVotes]="position.totalVotes"
                                [rank]="i + 1"></app-result-card>
                        </div>
                        }
                    </div>
                </div>
                }
                } @else if (selectedElectionId()) {
                <div class="flex flex-col items-center justify-center py-12 text-center">
                    <div class="p-4 bg-gray-50 rounded-full mb-3">
                        <ion-icon name="people-outline" class="text-3xl text-gray-300"></ion-icon>
                    </div>
                    <h3 class="text-base font-bold text-gray-900">No Results Found</h3>
                    <p class="text-xs text-gray-400 max-w-[200px]">There are no results recorded for this election
                        yet.</p>
                </div>
                }
            </div>
        </div>
    </div>
</ion-content>